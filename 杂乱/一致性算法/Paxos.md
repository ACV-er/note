# Paxos 算法

* 一致性算法，用于在分布式系统中保持各节点数据一致。

### 原理简介

* 首先，该一致性算法有三个角色，proposers，acceptors，和 learners。下文称提案者、接受者、学习者。

* 一个决议**首先**被**提案者**提出，然后由**接收者**批准。

#### 约束

1. 当且仅当接受没有回应过编号大于n的请求时，接受者接受编号为n的提案。

2. 如果一个编号为 n 的提案具有 value v，该提案被提出，那么存在一个多数派，要么他们中所有人都没有接受编号小于 n 的任何提案，要么他们已经接受的所有编号小于 n 的提案中编号最大的那个提案具有 value v。

## 决议的提出与批准

 * 通过一个决议分为两个阶段：

1. prepare阶段：
   1. 提案者选择一个提案编号n并将提案请求发送给接受者中的一个多数派；
     2. 接受者收到提案请求后，如果提案的编号大于它已经回复的所有prepare消息(回复消息表示接受accept)，则接受者将自己上次接受的提案回复给提案者，并承诺不再回复小于n的提案；
2. 批准阶段：
   1. 当一个提案者收到了多数接受者对提案的回复后，就进入批准阶段。它要向回复提案请求的接受者发送accept请求，包括编号n和根据约束2决定的value（如果根据约束2没有已经接受的value，那么它可以自由决定value）。
   2. 在不违背自己向其他提案者的承诺的前提下，接受者收到accept请求后即批准这个请求。

> 这个过程在任何时候中断都可以保证正确性。例如如果一个proposer发现已经有其他proposers提出了编号更高的提案，则有必要中断这个过程。因此为了优化，在上述prepare过程中，如果一个acceptor发现存在一个更高编号的提案，则需要通知proposer，提醒其中断这次提案。

### 参考文档

* `https://zh.m.wikipedia.org/zh/Paxos%E7%AE%97%E6%B3%95`

